# Choice.io

**Ваш персональный гид в мире аниме, основанный на настроении**  
Приложение, которое помогает подобрать идеальное аниме для просмотра через интуитивный Tinder-like интерфейс.

---

## ✨ Особенности

- **🎯 Персональный подбор** на основе текущего настроения
- **💫 Интуитивный интерфейс** с свайпами (like/dislike)
- **🎨 Минималистичный дизайн** с акцентом на контент
- **⚡ Уникальные визуальные решения** и плавные анимации

---

## 🎨 Дизайн

### 🔗 Ссылки

- [**Figma макет**](https://www.figma.com/design/Odl7j4Cp3IWWeRokEEFsFT/choice.io?node-id=0-1&p=f&t=s4nW7n0sYOxG9hLw-0) - основной дизайн проекта (choice.io design v.2.0)
- [**Дизайн документация**](documents/Дизайн%20приложения.docx) - описание дизайн-системы

### 🖼️ Макет

![design1](assets/design1.png)

### 🎨 Цветовая палитра

``` 
Основной текст: #000000
Акцентный цвет: #0022FF  
Успешное действие: #34C759
Ошибка/Отказ: #FF383C
```

### 🔤 Шрифты

- **Montserrat Bold** - основной текст
- **Montserrat Regular** - заголовки
- **Montserrat Medium** - второстепенный текст

---

## 🗃️ База данных / Backend часть

### 📊 Архитектура данных

- [**ER-диаграмма**](assets/er.png) - схема базы данных
- [**Документация**](documents/Серверная%20часть.docx) - описание backend-части

### 🔧 Технологии

- **Supabase** - облачная база данных
- **Jikan API** - внешний источник данных об аниме
- **Go** - бэкенд-сервер и сервис синхронизации

### 🗄️ ER-диаграмма

``` 

┌─────────────────┐        ┌─────────────────┐        ┌─────────────────┐
│      users      │        │    favorites    │        │      anime      │
├─────────────────┤        ├─────────────────┤        ├─────────────────┤
│ id (PK)         │◄───────┤ user_id (FK)    │        │ id (PK)         │
│ username        │        │ anime_id (FK)   ├───────►│ mal_id          │
│ password_hash   │        └─────────────────┘        │ url             │
└─────────────────┘                                   │ images          │
                                                      │ title           │
┌─────────────────┐        ┌─────────────────┐        │ title_english   │
│      genres     │        │  anime_genres   │        │ type            │
├─────────────────┤        ├─────────────────┤        │ episodes        │
│ id (PK)         │◄───────┤ genre_id (FK)   │        │ status          │
│ mal_id          │        │ anime_id (FK)   ├───────►│ rating          │
│ type            │        └─────────────────┘        │ score           │
│ name            │                                   │ synopsis        │
│ url             │                                   │ year            │
└─────────────────┘                                   │ image_url       │
                                                      │ large_image_url │
┌─────────────────┐        ┌─────────────────┐        └─────────────────┘
│      moods      │        │  mood_genres    │
├─────────────────┤        ├─────────────────┤
│ id (PK)         │◄───────┤ mood_id (FK)    │
│ name            │        │ genre_id (FK)   ├───────┐
└─────────────────┘        └─────────────────┘       │
                                                     │
                                                     ▼
                                             ┌─────────────────┐
                                             │     genres      │
                                             └─────────────────┘

```

### 📋 Основные таблицы:

- **users** — пользователи системы (id, username, password_hash)
- **anime** — кэшированные данные об аниме с MyAnimeList (mal_id, title, score, genres, и др.)
- **genres** — справочник жанров аниме (mal_id, name, type, url)
- **moods** — справочник настроений пользователя (name)
- **favorites** — избранное пользователей (связь user_id → anime_id)
- **anime_genres** — связь аниме с жанрами (многие-ко-многим)
- **mood_genres** — связь настроений с жанрами (многие-ко-многим)

🔗 Связи:

- **users** ↔ **favorites** ↔ **anime** — пользователь может добавлять аниме в избранное.
- **anime** ↔ **anime_genres** ↔ **genres** — у аниме может быть несколько жанров.
- **moods** ↔ **mood_genres** ↔ **genres** — у настроения может быть несколько связанных жанров.

### 🏗️ Архитектура backend-системы

``` 
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│ Мобильное       │    │ С# API Server   │    │ Supabase        │
│ приложение      │───►│ (REST API)      │───►│ PostgreSQL      │
│ (Kotlin)        │    │                 │    │                 │
└─────────────────┘    └─────────────────┘    └─────────────────┘
                                 │
                                 │
                         ┌─────────────────┐
                         │ Go Sync Service │
                         │ (Data Fetcher)  │
                         └─────────┬───────┘
                                   │
                                   ▼
                          ┌──────────────────┐
                          │ Jikan API        │
                          │ (данные об аниме)│
                          └──────────────────┘
```

### ⚙️ C# (.NET) API сервис

**Назначение:** Основной бэкенд для мобильного приложения  
**Функциональность:**
- REST API для мобильного клиента
- Аутентификация и авторизация
- Управление избранным
- Поиск и фильтрация аниме

🏗️ **Архитектура**:
- ASP.NET Core 9.0 - веб-фреймворк
- Supabase.Client - работа с БД
- Clean Architecture - слоистая структура
- Repository Pattern - доступ к данным

🚀 **Основные возможности**:
- Лента аниме по настроению - интеллектуальный подбор на основе выбранного настроения (happy/sad/calm/energetic)
- Tinder-like интерфейс - эндпоинты для свайп-механики
- Избранное пользователей - сохранение лайкнутых аниме
- Живой API - развернут на Render.com и готов к использованию

🔗 **Деплой**:
- URL API: https://api-service-choice-io.onrender.com
- Хостинг: Render.com (Docker контейнер)
- База данных: Supabase PostgreSQL
- Автодеплой: при пуше в main ветку

**Для теста**:
- URL API: https://api-service-choice-io.onrender.com/swagger

### 🔄 GO Сервис выгрузки данных

**Назначение:** Периодическое обновление данных из Jikan API  
**Функциональность:**
- Первоначальное наполнение базы популярными аниме
- Ежедневное обновление рейтингов и информации
- Обработка ограничений Jikan API (rate limiting)
- Логирование процесса синхронизации

---

## 🧪 Тестирование

### 📋 Тестовая документация

- [**Тест-план**](documents/Тестовая%20документация.docx) - стратегия и подход к тестированию
- [**Тест-кейсы**](documents/Тестовая%20документация.docx) - сценарии тестирования

### ✅ Области тестирования

- **API тестирование** - проверка REST endpoints
- **Интеграционное тестирование** - работа с Supabase и Jikan API
- **Функциональное тестирование** - основные сценарии приложения
- **Тестирование базы данных** - целостность и производительность

---

## 🚀 Начало работы

### 📋 Предварительные требования

- **Android Studio** (для мобильной разработки)
- **Go 1.21+** (для бэкенд-сервисов)

### ⚡ Установка

```
# Клонирование репозитория
git clone https://github.com/theun1c/choice.io.git

# Переход в директорию проекта
cd choice.io
```
---

# 📁 Структура проекта

```
choice.io/
├── mobile/                 # Мобильное приложение (Kotlin)
├── backend/
│   ├── api-server/         # .NET REST API сервер
│   └── sync-service/       # Go сервис синхронизации
├── documents/              # Документация
├── assets/                 # Изображения и ресурсы
└── README.md
```

---

# 📝 Конвенция коммитов  
| Название | Описание                                                             |  
| -------- | -------------------------------------------------------------------- |  
| docs     | обновление документации (readme)                                     |  
| feat     | добавление нового функционала                                        |  
| fix      | исправление ошибок                                                   |  
| delete   | удаление файлов проекта                                              |
| test     | добавление unit-тестов к проекту или тестовой документации           |
| note     | добавление заметки                                                   |
| global   | глобальные изменения файлов проекта                                  |

---


# Unloaded service

Сервис для выгрузки данных об аниме из MyAnimeList в Supabase.

## База данных

``` sql 

CREATE TABLE anime (
    id BIGSERIAL PRIMARY KEY,
    mal_id INTEGER UNIQUE NOT NULL,
    url TEXT NOT NULL,
    images JSONB,
    title TEXT NOT NULL,
    title_english TEXT,
    type TEXT,
    episodes INTEGER,
    status TEXT,
    rating TEXT,
    score DOUBLE PRECISION,
    synopsis TEXT,
    year INTEGER
);

CREATE TABLE genres (
    id BIGSERIAL PRIMARY KEY,
    mal_id INTEGER UNIQUE NOT NULL,
    type TEXT,
    name TEXT NOT NULL,
    url TEXT
);

CREATE TABLE anime_genres (
    anime_id BIGINT REFERENCES anime(id) ON DELETE CASCADE,
    genre_id BIGINT REFERENCES genres(id) ON DELETE CASCADE,
    PRIMARY KEY (anime_id, genre_id)
);

```

## Использование 

создать .env файл в корне проекта

``` bash 
API_KEY=твой_supabase_ключ
API_URL=твой_supabase_адрес

``` 

Запустить сервис и следовать инструкциям в консоли 

``` bash 
unloader := services.NewUnloader()
unloader.Start()
```

## Что делает 

- Загружает аниме с MyAnimeList
- Проверяет дубликаты
- Сохраняет в 3 таблицы: аниме, жанры и связи между ними
- Показывает статистику по каждой странице

## Структура 

- anime - основные данные аниме
- genres - жанры
- anime_genres - связи аниме с жанрами (многие-ко-многим)
